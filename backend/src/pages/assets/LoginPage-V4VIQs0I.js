import{d as B,r,o as q,c as b,a as t,b as v,w as c,u as f,e as S,F as h,f as n,t as V,g as k,v as _,h as C,i as U,j as P,k as x,B as R}from"./index-CWOFgP__.js";import{u as $,U as D,r as F,N as M,S as T}from"./apath-Bhetf7Vd.js";import{N as j}from"./headers-ChCDR5PC.js";const A={class:"ax-card ax-center ax-main"},E={class:"append-text"},H={href:""},I={class:"ax-input-box"},L=["disabled"],X={class:"ax-input-box"},z=["disabled"],G={class:"ax-button-box"},W=B({__name:"LoginPage",setup(J){const l=C(),m=U(),g=$(),o=l.query.service||"default",a=r(!0),i=r(new T);let y=l.query.path;const u=r(""),d=r("");async function w(){if(a.value)return;a.value=!0;const s=await D.login(u.value,d.value,o);a.value=!1,s.success?(g.success({title:"登录成功",duration:3e3}),location.href=F(l.query.path,s.tgt,s.ticket)):g.error({title:"登录失败",content:s.message,duration:3e3})}return q(async()=>{try{await i.value.fetch(o),y||(y=i.value.servicePath??`https://go.abstrax.cn/?service=${o}`),a.value=!1}catch(s){console.log(s),s.response&&s.response.status===404?m.push({path:"/error",query:{code:404,mes:`不存在名为${o}的服务`}}):m.push({path:"/error",query:{code:500,mes:`查询服务${o}信息时出错`}})}}),(s,e)=>{const N=P("router-link");return x(),b(h,null,[t("div",A,[v(f(j),{class:"ax-header"},{default:c(()=>e[2]||(e[2]=[n("AbstraX")])),_:1}),t("div",E,[a.value?(x(),S(f(M),{key:0,text:"",style:{width:"60%"}})):(x(),b(h,{key:1},[e[3]||(e[3]=n(" 登录至")),t("a",H,V(i.value.serviceName),1)],64))]),t("div",I,[k(t("input",{class:"ax-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=p=>u.value=p),placeholder:"用户名, 邮箱, 或者手机号",disabled:a.value},null,8,L),[[_,u.value]]),e[4]||(e[4]=t("div",{class:"ax-input-bar"},null,-1))]),t("div",X,[k(t("input",{class:"ax-input",type:"password","onUpdate:modelValue":e[1]||(e[1]=p=>d.value=p),placeholder:"密码",disabled:a.value},null,8,z),[[_,d.value]]),e[5]||(e[5]=t("div",{class:"ax-input-bar"},null,-1))]),t("div",G,[t("div",null,[e[7]||(e[7]=n(" 还没账号，立刻")),v(N,{to:"/register"},{default:c(()=>e[6]||(e[6]=[n("注册")])),_:1})]),v(f(R),{type:"info",style:{"border-radius":"0","padding-left":"40px","padding-right":"40px"},disabled:a.value,onClick:w},{default:c(()=>e[8]||(e[8]=[n("登录")])),_:1},8,["disabled"])])]),e[9]||(e[9]=t("div",{class:"ax-light"},null,-1))],64)}}});export{W as default};
