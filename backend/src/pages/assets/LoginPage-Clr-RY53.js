import{d as B,r as n,o as S,c as i,a as s,b as x,w as m,u,e as C,F as b,f as l,t as V,g as w,v as _,h as U,i as q,j as A,k as r,B as P}from"./index-aVLYjZOP.js";import{u as $,U as D,S as F}from"./UserServices-BI34ifnN.js";import{N as M}from"./headers-Bz4uihiD.js";import{N as R}from"./settings-Cyt-79II.js";const T={class:"ax-card ax-center ax-main"},j={class:"append-text"},E=["href"],H={class:"ax-input-box"},I=["disabled"],L={class:"ax-input-box"},X=["disabled"],z={class:"ax-button-box"},W=B({__name:"LoginPage",setup(G){const y=U(),g=q(),k=$(),a=n(y.query.service||"default"),t=n(!0),d=n(new F);let v=y.query.path;const p=n(""),c=n("");async function h(){if(t.value)return;t.value=!0;const o=await D.login(p.value,c.value,a.value);t.value=!1,o.success?(k.success({title:"登录成功",duration:3e3}),g.push(o.callback??"/user")):k.error({title:"登录失败",content:o.message,duration:3e3})}return S(async()=>{try{await d.value.fetch(a.value),v||(v=d.value.servicePath??`https://go.abstrax.cn/?service=${a.value}`)}catch(o){o.response&&o.response.status===404?(console.warn(`Service ${a.value} not found`),a.value="default"):g.push({path:"/error",query:{code:500,mes:`查询服务${a.value}信息时出错`}})}finally{t.value=!1}}),(o,e)=>{const N=A("router-link");return r(),i(b,null,[s("div",T,[x(u(M),{class:"ax-header"},{default:m(()=>e[2]||(e[2]=[l("AbstraX")])),_:1}),s("div",j,[t.value?(r(),C(u(R),{key:0,text:"",style:{width:"60%"}})):(r(),i(b,{key:1},[e[3]||(e[3]=l(" 登录至")),a.value!=="default"?(r(),i("a",{key:0,href:u(v)},V(d.value.serviceName),9,E)):(r(),i(b,{key:1},[l("Abstrax CAS")],64))],64))]),s("div",H,[w(s("input",{class:"ax-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=f=>p.value=f),placeholder:"用户名, 邮箱, 或者手机号",disabled:t.value},null,8,I),[[_,p.value]]),e[4]||(e[4]=s("div",{class:"ax-input-bar"},null,-1))]),s("div",L,[w(s("input",{class:"ax-input",type:"password","onUpdate:modelValue":e[1]||(e[1]=f=>c.value=f),placeholder:"密码",disabled:t.value},null,8,X),[[_,c.value]]),e[5]||(e[5]=s("div",{class:"ax-input-bar"},null,-1))]),s("div",z,[s("div",null,[e[7]||(e[7]=l(" 还没账号，立刻")),x(N,{to:"/register"},{default:m(()=>e[6]||(e[6]=[l("注册")])),_:1})]),x(u(P),{type:"info",style:{"border-radius":"0","padding-left":"40px","padding-right":"40px"},disabled:t.value,onClick:h},{default:m(()=>e[8]||(e[8]=[l("登录")])),_:1},8,["disabled"])])]),e[9]||(e[9]=s("div",{class:"ax-light"},null,-1))],64)}}});export{W as default};
