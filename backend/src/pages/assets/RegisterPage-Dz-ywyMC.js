import{d as R,r as o,o as A,c as B,a,b as d,w as u,u as r,e as F,F as N,f as i,g as f,v as x,h as j,i as H,j as L,k as h,t as X,l as z,B as w,N as G}from"./index-aVLYjZOP.js";import{u as J,U as K,S as O}from"./UserServices-BI34ifnN.js";import{N as Q,B as D}from"./settings-Cyt-79II.js";import{B as W}from"./BaseServices-CFey6swV.js";import{N as Y}from"./headers-Bz4uihiD.js";const Z={class:"ax-card ax-center ax-main"},ee={class:"append-text"},ae={class:"ax-register-container"},te={class:"ax-input-box"},se=["disabled"],le={class:"ax-input-box"},oe=["disabled"],ne={class:"ax-input-box"},ue=["disabled"],ie={class:"ax-input-box"},de={class:"ax-input-box-group"},re=["disabled"],ve={class:"ax-input-box"},pe=["disabled"],ce={class:"ax-button-box"},fe={class:"ax-input-box ax-input-captcha"},xe={class:"ax-input-box-group"},me=["disabled"],be=["src"],_e=R({__name:"RegisterPage",setup(ge){const U=j(),S=H(),m=J(),v=o(U.query.service||"default"),t=o(!0),V=o(new O);let I=U.query.path;const C=o(""),g=o(""),k=o(""),y=o(""),_=o(""),p=o(!1),b=o(""),$=o(`${D.url}/captcha`),n=o(0),c=o(null);async function P(){b.value="",p.value=!0}async function M(){b.value="",$.value=`${D.url}/captcha?${new Date().getTime()}`}async function T(){if(t.value||n.value>0)return;t.value=!0;const l=await W.sendEmailCaptcha(y.value,b.value);t.value=!1,l.success?(n.value=60,p.value=!1,m.success({title:"发送验证码成功",duration:3e3})):(m.error({title:"发送验证码失败",content:l.message,duration:3e3}),l.lastingSeconds&&(n.value=l.lastingSeconds),l.message==="Invalid image captcha"?M():p.value=!1),c.value&&(clearInterval(c.value),c.value=null),n.value>0&&(c.value=setInterval(()=>{if(n.value<=0){clearInterval(c.value),c.value=null;return}n.value--},1e3))}async function q(){if(t.value)return;if(g.value!==k.value){m.error({title:"两次密码不一致",content:"请确认两次输入的密码一致",duration:3e3});return}t.value=!0;const l=await K.register(C.value,y.value,g.value,_.value,v.value);t.value=!1,l.success?(m.success({title:"注册成功",duration:3e3}),S.push(l.callback??"/user")):m.error({title:"注册失败",content:l.message,duration:3e3})}return A(async()=>{try{await V.value.fetch(v.value),I||(I=V.value.servicePath??`https://go.abstrax.cn/?service=${v.value}`)}catch(l){l.response&&l.response.status===404?(console.warn(`Service ${v.value} not found`),v.value="default"):S.push({path:"/error",query:{code:500,mes:`查询服务${v.value}信息时出错`}})}finally{t.value=!1}}),(l,e)=>{const E=L("router-link");return h(),B(N,null,[a("div",Z,[d(r(Y),{class:"ax-header"},{default:u(()=>e[8]||(e[8]=[i("AbstraX")])),_:1}),a("div",ee,[t.value?(h(),F(r(Q),{key:0,text:"",style:{width:"60%"}})):(h(),B(N,{key:1},[i(" 注册新的 Abstrax 通行证 ")],64))]),a("div",ae,[a("div",te,[f(a("input",{class:"ax-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=s=>C.value=s),placeholder:"用户名",disabled:t.value},null,8,se),[[x,C.value]]),e[9]||(e[9]=a("div",{class:"ax-input-bar"},null,-1))]),a("div",le,[f(a("input",{class:"ax-input",type:"password","onUpdate:modelValue":e[1]||(e[1]=s=>g.value=s),placeholder:"密码",disabled:t.value},null,8,oe),[[x,g.value]]),e[10]||(e[10]=a("div",{class:"ax-input-bar"},null,-1))]),a("div",ne,[f(a("input",{class:"ax-input",type:"password","onUpdate:modelValue":e[2]||(e[2]=s=>k.value=s),placeholder:"确认密码",disabled:t.value},null,8,ue),[[x,k.value]]),e[11]||(e[11]=a("div",{class:"ax-input-bar"},null,-1))]),a("div",ie,[a("div",de,[f(a("input",{class:"ax-input",type:"email","onUpdate:modelValue":e[3]||(e[3]=s=>y.value=s),placeholder:"邮箱",disabled:t.value},null,8,re),[[x,y.value]]),d(r(w),{type:"info",strong:"",secondary:"",style:{"border-radius":"0"},disabled:t.value||n.value>0,onClick:P},{default:u(()=>[e[12]||(e[12]=i("获取验证码")),n.value>0?(h(),B(N,{key:0},[i("("+X(n.value)+") ",1)],64)):z("",!0)]),_:1},8,["disabled"])])]),a("div",ve,[f(a("input",{class:"ax-input",type:"text","onUpdate:modelValue":e[4]||(e[4]=s=>_.value=s),placeholder:"邮箱验证码",disabled:t.value},null,8,pe),[[x,_.value]]),e[13]||(e[13]=a("div",{class:"ax-input-bar"},null,-1))]),a("div",ce,[a("div",null,[e[15]||(e[15]=i(" 已有账号，立刻")),d(E,{to:"/"},{default:u(()=>e[14]||(e[14]=[i("登录")])),_:1})]),d(r(w),{type:"info",style:{"border-radius":"0","padding-left":"40px","padding-right":"40px"},disabled:t.value,onClick:q},{default:u(()=>e[16]||(e[16]=[i("注册")])),_:1},8,["disabled"])])])]),d(r(G),{show:p.value,"onUpdate:show":e[7]||(e[7]=s=>p.value=s),preset:"dialog",title:"Dialog"},{header:u(()=>e[17]||(e[17]=[a("div",null,"图片验证码",-1)])),action:u(()=>[d(r(w),{strong:"",secondary:"",onClick:e[6]||(e[6]=s=>p.value=!1)},{default:u(()=>e[18]||(e[18]=[i("取消")])),_:1}),d(r(w),{type:"primary",onClick:T,disabled:t.value},{default:u(()=>e[19]||(e[19]=[i("确定")])),_:1},8,["disabled"])]),default:u(()=>[a("div",null,[a("div",fe,[a("div",xe,[f(a("input",{class:"ax-input",type:"text","onUpdate:modelValue":e[5]||(e[5]=s=>b.value=s),placeholder:"图片验证码",maxlength:"4",disabled:t.value},null,8,me),[[x,b.value]]),a("img",{src:$.value,onClick:M},null,8,be)])])])]),_:1},8,["show"]),e[20]||(e[20]=a("div",{class:"ax-light"},null,-1))],64)}}});export{_e as default};
