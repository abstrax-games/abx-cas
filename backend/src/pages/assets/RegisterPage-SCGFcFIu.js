import{d as E,r as o,o as A,c as N,a,b as r,w as i,u as d,e as F,F as U,f as u,g as f,v as x,h as j,i as H,j as L,k as h,t as X,l as z,B as w,N as G}from"./index-DhWzz5qN.js";import{u as J,U as K,r as O,S as Q}from"./apath-CoBB-JEe.js";import{N as W,B as M}from"./settings-B74Ox_z4.js";import{B as Y}from"./BaseServices-yD73LbLu.js";import{N as Z}from"./headers-D8ku1YYq.js";const ee={class:"ax-card ax-center ax-main"},ae={class:"append-text"},te={class:"ax-register-container"},se={class:"ax-input-box"},le=["disabled"],oe={class:"ax-input-box"},ne=["disabled"],ie={class:"ax-input-box"},ue=["disabled"],re={class:"ax-input-box"},de={class:"ax-input-box-group"},ve=["disabled"],pe={class:"ax-input-box"},ce=["disabled"],fe={class:"ax-button-box"},xe={class:"ax-input-box ax-input-captcha"},me={class:"ax-input-box-group"},be=["disabled"],ge=["src"],Be=E({__name:"RegisterPage",setup(ye){const C=j(),q=H(),m=J(),v=o(C.query.service||"default"),t=o(!0),S=o(new Q);let V=C.query.path;const k=o(""),g=o(""),_=o(""),y=o(""),B=o(""),p=o(!1),b=o(""),I=o(`${M.url}/captcha`),n=o(0),c=o(null);async function D(){b.value="",p.value=!0}async function $(){b.value="",I.value=`${M.url}/captcha?${new Date().getTime()}`}async function P(){if(t.value||n.value>0)return;t.value=!0;const s=await Y.sendEmailCaptcha(y.value,b.value);t.value=!1,s.success?(n.value=60,p.value=!1,m.success({title:"发送验证码成功",duration:3e3})):(m.error({title:"发送验证码失败",content:s.message,duration:3e3}),s.lastingSeconds&&(n.value=s.lastingSeconds),s.message==="Invalid image captcha"?$():p.value=!1),c.value&&(clearInterval(c.value),c.value=null),n.value>0&&(c.value=setInterval(()=>{if(n.value<=0){clearInterval(c.value),c.value=null;return}n.value--},1e3))}async function R(){if(t.value)return;if(g.value!==_.value){m.error({title:"两次密码不一致",content:"请确认两次输入的密码一致",duration:3e3});return}t.value=!0;const s=await K.register(k.value,y.value,g.value,B.value,v.value);t.value=!1,s.success?(m.success({title:"注册成功",duration:3e3}),location.href=O(C.query.path,s.tgt,s.ticket)):m.error({title:"注册失败",content:s.message,duration:3e3})}return A(async()=>{try{await S.value.fetch(v.value),V||(V=S.value.servicePath??`https://go.abstrax.cn/?service=${v.value}`)}catch(s){s.response&&s.response.status===404?(console.warn(`Service ${v.value} not found`),v.value="default"):q.push({path:"/error",query:{code:500,mes:`查询服务${v}信息时出错`}})}finally{t.value=!1}}),(s,e)=>{const T=L("router-link");return h(),N(U,null,[a("div",ee,[r(d(Z),{class:"ax-header"},{default:i(()=>e[8]||(e[8]=[u("AbstraX")])),_:1}),a("div",ae,[t.value?(h(),F(d(W),{key:0,text:"",style:{width:"60%"}})):(h(),N(U,{key:1},[u(" 注册新的 Abstrax 通行证 ")],64))]),a("div",te,[a("div",se,[f(a("input",{class:"ax-input",type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>k.value=l),placeholder:"用户名",disabled:t.value},null,8,le),[[x,k.value]]),e[9]||(e[9]=a("div",{class:"ax-input-bar"},null,-1))]),a("div",oe,[f(a("input",{class:"ax-input",type:"password","onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),placeholder:"密码",disabled:t.value},null,8,ne),[[x,g.value]]),e[10]||(e[10]=a("div",{class:"ax-input-bar"},null,-1))]),a("div",ie,[f(a("input",{class:"ax-input",type:"password","onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),placeholder:"确认密码",disabled:t.value},null,8,ue),[[x,_.value]]),e[11]||(e[11]=a("div",{class:"ax-input-bar"},null,-1))]),a("div",re,[a("div",de,[f(a("input",{class:"ax-input",type:"email","onUpdate:modelValue":e[3]||(e[3]=l=>y.value=l),placeholder:"邮箱",disabled:t.value},null,8,ve),[[x,y.value]]),r(d(w),{type:"info",strong:"",secondary:"",style:{"border-radius":"0"},disabled:t.value||n.value>0,onClick:D},{default:i(()=>[e[12]||(e[12]=u("获取验证码")),n.value>0?(h(),N(U,{key:0},[u("("+X(n.value)+") ",1)],64)):z("",!0)]),_:1},8,["disabled"])])]),a("div",pe,[f(a("input",{class:"ax-input",type:"text","onUpdate:modelValue":e[4]||(e[4]=l=>B.value=l),placeholder:"邮箱验证码",disabled:t.value},null,8,ce),[[x,B.value]]),e[13]||(e[13]=a("div",{class:"ax-input-bar"},null,-1))])]),a("div",fe,[a("div",null,[e[15]||(e[15]=u(" 已有账号，立刻")),r(T,{to:"/"},{default:i(()=>e[14]||(e[14]=[u("登录")])),_:1})]),r(d(w),{type:"info",style:{"border-radius":"0","padding-left":"40px","padding-right":"40px"},disabled:t.value,onClick:R},{default:i(()=>e[16]||(e[16]=[u("注册")])),_:1},8,["disabled"])])]),r(d(G),{show:p.value,"onUpdate:show":e[7]||(e[7]=l=>p.value=l),preset:"dialog",title:"Dialog"},{header:i(()=>e[17]||(e[17]=[a("div",null,"图片验证码",-1)])),action:i(()=>[r(d(w),{strong:"",secondary:"",onClick:e[6]||(e[6]=l=>p.value=!1)},{default:i(()=>e[18]||(e[18]=[u("取消")])),_:1}),r(d(w),{type:"primary",onClick:P,disabled:t.value},{default:i(()=>e[19]||(e[19]=[u("确定")])),_:1},8,["disabled"])]),default:i(()=>[a("div",null,[a("div",xe,[a("div",me,[f(a("input",{class:"ax-input",type:"text","onUpdate:modelValue":e[5]||(e[5]=l=>b.value=l),placeholder:"图片验证码",maxlength:"4",disabled:t.value},null,8,be),[[x,b.value]]),a("img",{src:I.value,onClick:$},null,8,ge)])])])]),_:1},8,["show"]),e[20]||(e[20]=a("div",{class:"ax-light"},null,-1))],64)}}});export{Be as default};
